# Implementation Plan

- [x] 1. 项目初始化和共享类型定义
  - [x] 1.1 创建项目根目录结构和 monorepo 配置
    - 创建 client/、server/、shared/ 目录
    - 配置根 package.json 和 workspace
    - _Requirements: 8.1_
  - [x] 1.2 定义共享类型接口
    - 在 shared/types.ts 中定义 WordCard、GameConfig、BoardState、GameState 等接口
    - _Requirements: 5.2, 8.5_
  - [ ]* 1.3 编写 WordCard 结构验证属性测试
    - **Property 7: WordCard Structure Validity**
    - **Validates: Requirements 5.2, 8.5**

- [x] 2. 后端基础搭建
  - [x] 2.1 初始化后端项目
    - 创建 Express 服务器
    - 配置 TypeScript 和开发脚本
    - _Requirements: 8.1_
  - [x] 2.2 实现本地词库模块
    - 创建中文成语词库 zh-idioms.json
    - 创建英文词汇词库 en-words.json
    - 实现 LocalWordBank 服务
    - _Requirements: 5.3_
  - [x] 2.3 实现 AI 服务模块
    - 实现 AIService 类
    - 实现 prompt 构建逻辑
    - 实现 JSON 响应解析
    - 实现失败重试和本地兜底逻辑
    - _Requirements: 8.2, 8.3, 8.4_
  - [ ]* 2.4 编写 JSON 响应解析属性测试
    - **Property 12: JSON Response Parsing**
    - **Validates: Requirements 8.3**
  - [x] 2.5 实现词语生成 API 路由
    - POST /api/words/generate 端点
    - 参数验证和错误处理
    - _Requirements: 8.1, 5.4_
  - [ ]* 2.6 编写 API 参数验证属性测试
    - **Property 11: API Parameter Validation**
    - **Validates: Requirements 8.1**
  - [ ]* 2.7 编写配对数量属性测试
    - **Property 8: Pair Count Matches Board Size**
    - **Validates: Requirements 5.4**

- [x] 3. Checkpoint - 确保后端测试通过
  - Ensure all tests pass, ask the user if questions arise.

- [x] 4. 前端基础搭建
  - [x] 4.1 初始化前端项目
    - 创建 Vite + Phaser 3 项目
    - 配置 TypeScript
    - _Requirements: 2.1_
  - [x] 4.2 实现游戏配置和难度映射
    - 实现难度到棋盘尺寸的映射逻辑
    - _Requirements: 1.3_
  - [ ]* 4.3 编写难度映射属性测试
    - **Property 1: Difficulty-to-Board-Size Mapping**
    - **Validates: Requirements 1.3**
  - [x] 4.4 实现 API 服务层
    - 创建 ApiService 类
    - 实现词语获取、解释获取、总结获取方法
    - _Requirements: 5.1_

- [x] 5. 核心游戏逻辑实现
  - [x] 5.1 实现 BoardManager
    - 实现棋盘初始化
    - 实现卡片随机布局
    - 实现卡片获取和移除
    - 实现游戏完成检测
    - _Requirements: 2.1, 2.2_
  - [ ]* 5.2 编写棋盘维度属性测试
    - **Property 2: Board Dimensions Match Configuration**
    - **Validates: Requirements 2.1**
  - [ ]* 5.3 编写卡片配对完整性属性测试
    - **Property 3: Card Pairing Completeness**
    - **Validates: Requirements 2.2**
  - [x] 5.4 实现 PathFinder
    - 实现 BFS 路径搜索算法
    - 实现 0/1/2 拐点路径检测
    - 实现路径有效性验证
    - _Requirements: 3.2, 3.3, 3.4, 3.5_
  - [ ]* 5.5 编写路径查找属性测试
    - **Property 5: Path Finding Correctness**
    - **Validates: Requirements 3.2, 3.3, 3.4, 3.5**
  - [x] 5.6 实现匹配逻辑
    - 实现卡片匹配判断
    - 实现路径失败与内容失败区分
    - _Requirements: 2.4, 4.1, 4.2, 4.5_
  - [ ]* 5.7 编写匹配评估属性测试
    - **Property 4: Match Evaluation Correctness**
    - **Validates: Requirements 2.4, 4.1, 4.2**
  - [ ]* 5.8 编写匹配失败区分属性测试
    - **Property 6: Match Failure Distinction**
    - **Validates: Requirements 4.5**

- [x] 6. Checkpoint - 确保核心逻辑测试通过
  - Ensure all tests pass, ask the user if questions arise.

- [x] 7. 游戏状态管理
  - [x] 7.1 实现游戏状态序列化
    - 实现 GameState 序列化为 JSON
    - 实现 JSON 反序列化为 GameState
    - 实现数据完整性验证
    - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5_
  - [ ]* 7.2 编写序列化往返属性测试
    - **Property 13: Game State Serialization Round-Trip**
    - **Validates: Requirements 9.5**
  - [x] 7.3 实现游戏统计计算
    - 实现正确/错误计数
    - 实现时间统计
    - _Requirements: 6.2_
  - [ ]* 7.4 编写游戏统计属性测试
    - **Property 9: Game Statistics Accuracy**
    - **Validates: Requirements 6.2**
  - [x] 7.5 实现动态难度调整
    - 实现连续正确/错误检测
    - 实现难度调整触发逻辑
    - _Requirements: 7.1, 7.2_
  - [ ]* 7.6 编写难度调整属性测试
    - **Property 10: Difficulty Adjustment Triggers**
    - **Validates: Requirements 7.1, 7.2**

- [x] 8. Checkpoint - 确保状态管理测试通过
  - Ensure all tests pass, ask the user if questions arise.

- [-] 9. Phaser 场景实现
  - [x] 9.1 实现 BootScene
    - 加载游戏资源
    - 初始化游戏配置
    - _Requirements: 1.1_
  - [x] 9.2 实现 MenuScene
    - 实现设置面板 UI
    - 实现语言/难度/主题选择
    - 实现开始游戏按钮
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_
  - [x] 9.3 实现 GameScene
    - 实现棋盘渲染
    - 实现卡片点击交互
    - 实现匹配动画
    - 实现路径连线动画
    - _Requirements: 2.1, 2.3, 3.6_
  - [x] 9.4 实现 CardManager
    - 实现卡片精灵创建
    - 实现选中/取消选中效果
    - 实现移除动画
    - _Requirements: 2.3, 4.1_
  - [x] 9.5 实现游戏结束和总结界面
    - 实现游戏完成检测
    - 实现统计展示
    - 实现 AI 总结展示
    - 实现重玩/返回按钮
    - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 10. 集成和完善
  - [x] 10.1 前后端联调
    - 测试词语生成 API 调用
    - 测试 AI 解释获取
    - 测试学习总结获取
    - _Requirements: 5.1, 4.3, 6.3_
  - [x] 10.2 实现 AI 反馈展示
    - 实现匹配后的解释弹窗
    - 实现提示高亮功能
    - _Requirements: 4.4, 7.3_
  - [x] 10.3 优化用户体验
    - 添加加载状态指示
    - 添加错误提示
    - 优化动画效果
    - _Requirements: 4.4_

- [x] 11. Final Checkpoint - 确保所有测试通过
  - Ensure all tests pass, ask the user if questions arise.
